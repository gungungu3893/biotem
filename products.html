<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BIOTEM 제품 결제 테스트</title>
    <script src="https://sdk.minepi.com/pi-sdk.js"></script>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; padding: 20px; text-align: center; background-color: #f4f4f4; }
        .product-card { background: white; border: 1px solid #ddd; padding: 20px; margin: 15px auto; border-radius: 15px; max-width: 300px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .price { color: #e44d26; font-weight: bold; font-size: 1.4em; margin: 10px 0; }
        .buy-btn { background-color: #ffd700; color: #333; padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 1em; width: 100%; }
        .status { margin-top: 15px; font-size: 0.9em; color: #666; }
    </style>
</head>
<body>
    <h1>BIOTEM 테스트 결제</h1>
    <p>아래 버튼을 눌러 10번 단계를 완료하세요.</p>
    
    <div class="product-card">
        <h3>테스트용 지주대</h3>
        <p>Citizen Cincom 가공 샘플</p>
        <p class="price">0.1 Test-Pi</p>
        <button class="buy-btn" onclick="transferPi()">결제하기</button>
        <div id="status-msg" class="status">버튼을 눌러 결제를 시작하세요.</div>
    </div>

    <p><a href="index.html" style="color: #999; text-decoration: none;">홈으로 돌아가기</a></p>

    <script>
        // 10번 단계(실제 결제창 띄우기)를 위해 sandbox를 반드시 false로 설정합니다.
        Pi.init({ version: "2.0", sandbox: false });

        async function transferPi() {
            const statusMsg = document.getElementById('status-msg');
            statusMsg.innerText = "결제창을 불러오는 중...";

            try {
                const payment = await Pi.createPayment({
                    amount: 0.1,
                    memo: "10번 단계 완료를 위한 테스트 결제",
                    metadata: { productId: "test_product_001" },
                }, {
                    onReadyForServerApproval: function(paymentId) {
                        statusMsg.innerText = "결제가 생성되었습니다. 서버 승인 대기 중...";
                        console.log("Payment ID:", paymentId);
                        // 초보 단계에서는 창이 떠서 지갑 비번 입력 단계까지만 가도 성공입니다.
                    },
                    onReadyForServerCompletion: function(paymentId, txid) {
                        statusMsg.innerText = "결제 완료 처리 중...";
                    },
                    onCancel: function(paymentId) {
                        statusMsg.innerText = "결제가 취소되었습니다.";
                    },
                    onError: function(error, payment) {
                        statusMsg.innerText = "에러: " + error.message;
                        console.error(error);
                    }
                });
            } catch (err) {
                statusMsg.innerText = "결제 오류: Pi Browser 환경을 확인하세요.";
                alert("결제를 시작할 수 없습니다. \n1. Pi Browser 주소창에 직접 주소를 쳤는지 확인 \n2. 포털 설정 주소와 현재 주소가 같은지 확인");
            }
        }
    </script>
</body>
</html>
