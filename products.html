<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BIOTEM 결제</title>
  <script src="https://sdk.minepi.com/pi-sdk.js"></script>
</head>
<body>
  <h1>BIOTEM 테스트 결제</h1>
  <p>0.1 Pi</p>
  <button id="pay">결제하기</button>
  <div id="status"></div>

  <script>
    Pi.init({ version: "2.0", sandbox: false });

    const SERVER = "https://너의-render-서버.onrender.com";

    document.getElementById("pay").onclick = async () => {
      document.getElementById("status").innerText = "결제 요청 중...";

      Pi.createPayment(
        {
          amount: 0.1,
          memo: "BIOTEM 테스트 결제",
          metadata: { product: "abutment" },
        },
        {
          onReadyForServerApproval: async (paymentId) => {
            await fetch(`${SERVER}/approve`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ paymentId }),
            });
          },
          onReadyForServerCompletion: async (paymentId, txid) => {
            await fetch(`${SERVER}/complete`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ paymentId, txid }),
            });
            document.getElementById("status").innerText = "결제 완료";
          },
          onCancel: () => {
            document.getElementById("status").innerText = "취소됨";
          },
          onError: (e) => {
            document.getElementById("status").innerText = "에러 발생";
            console.error(e);
          },
        }
      );
    };
  </script>
</body>
</html>
